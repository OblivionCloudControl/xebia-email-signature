<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/static/favicon.png"
    />
    <title>Xebia's Email Signature Generator</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/choices.js@10.2.0/public/assets/styles/base.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/choices.js@10.2.0/public/assets/styles/choices.min.css"
    />
    <link href="/static/styles.css" rel="stylesheet" />
  </head>
  <body>
    <main class="main">
      <img class="logo" src="/static/xebia-logo.svg" alt="Xebia logo" />

      <h1 class="site-title">Email Signature Generator</h1>

      <div class="form-container">
        <form
          class="js-form"
          action="/new/signature"
          method="post"
          enctype="multipart/form-data"
          target="preview-iframe"
          onsubmit="handleFormSubmit()"
        >
          <div class="form-group">
            <label for="full_name">Name</label>
            <input
              type="text"
              id="full_name"
              name="full_name"
              placeholder="John Doe"
              onblur="prefillEmail(this.value)"
            />
            <div id="full_name-error" class="error"></div>
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input
              type="text"
              id="email"
              name="email"
              placeholder="john.doe@xebia.com"
              onchange="validateEmail()"
            />
            <div id="email-error" class="error"></div>
          </div>

          <div class="form-group">
            <label for="job_role">Role</label>
            <input
              type="text"
              id="job_role"
              name="job_role"
              placeholder="Senior Designer | Netherlands"
            />
            <div id="job_role-error" class="error"></div>
          </div>

          <div class="form-group">
            <label for="unit"
              >Unit
              <span
                >Optional: If you leave this blank, this field is not going to
                appear</span
              ></label
            >
            <input
              type="text"
              id="unit"
              name="unit"
              placeholder="Software Technology"
            />
            <div id="unit-error" class="error"></div>
          </div>

          <div class="form-group">
            <label for="phone">Phone</label>
            <input
              placeholder="+14043434832"
              type="text"
              id="phone"
              name="phone"
              placeholder="+00000000000"
              onchange="validatePhoneNumber();"
            />
            <div id="phone-error" class="error"></div>
          </div>

          <div>
            <div class="js-form-sm" data-clone-count="0">
              <div class="form-section">
                <div class="form-group select-icon-picker">
                  <label for="sm-0-icon">Icon</label>
                  <select class="js-choice" id="sm-0-icon" name="sm[0][icon]">
                    <option
                      value="linkedin"
                      data-custom-properties="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAZCAYAAAArK+5dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJDSURBVHgBtVY7ctNQFD1X0lAypicg78BpGDrsFcTZANgteCZmBcYdpTM2tEgriHcQpaVB7EATk15Di54u90rIKLYUW05yCul9pHPe/UqEHRi7A/dPir7F/BKEVrbIiAH6adsIZpEX3fU+1W2M3EEXhicy7OIuMEIiOp+vPG8vAT1xYvjbTuJtBI5Nw02Lbgm8dwcd2/AFAy4OgJBFJqXTrzdeWFrLoSc3hi8PJS8hFkuOC0usYvWByBUt5ZIDt9YCo+dvJ5vkBPIWK5/kPkRDKFeSYpzxqJIo/qgQGBaZMTp6x2gOdVXbMQb9atfwRFI1opRP+BD6zFXoOww+qdzW8BuI63QgV0LETBGI1beuWLgU4RYRd+Tu1nC8seRSuSmU/mLl9RwbeQyYpjpHSh8di9rza28o81Pbop6KVwowdy1h6qABFr+8IAE6o6NBX+eajpySX31IuBYaQutFWsilvH6hhalrtRZA05S0ce2PxPy32DY7rY/VgggNICFvNXg4EgG6wiOBmEILKZZ4JLANP2t2UqkStI32rH3eQqi5LjPNmCCvhSyti2er1vLTy/r82m87ORlNxZ7bAgQtoHIQuxUV3a2tcuUU2Hr5/juMXj09fiakr/EQYDqXevmsw3UdOA4+iUCI+0I4hHxcTNcCUpGxtICeDO8RdFr+4yjpVeDDi8FYeshZbRPb4kXMhqZfbrzZ9lYN8k+oBJFwJk2rpmIpkGy7EvfO1APV2ntAP0pJIhkl/0VaycZG+EQ6QB1pGX8BUJj0LsdL2e0AAAAASUVORK5CYII="
                    >
                      LinkedIn
                    </option>
                    <option
                      value="x"
                      data-custom-properties="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAZCAYAAAArK+5dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALZSURBVHgBrVa7ctNQEN2VFCYNIPrEiC/AKcjQxXR0kC5VrLTg4OQLYnd0ticOM1TIXxDzBbFbGpySCuXVeygTSctZOY4fsiyP4cxYc1979nn3mikDB47r3EX03hB5Tkx2vCjUJ+Jz06RO3ff8efKctlFy3AKFcoRhgeZBqMfMjeMrz1tIgVochPItkziJjmXy3rRHEwo+OG7eDOVUiBxaAiDzw4i3v9x4vbG1AdTyMJSzZcnH0IcnG0NPjOHqfyJX2MoFg+OCsPRTWts9miaHa54wX4zmUhSZMoDjamqwyFPIHwyXlSuI4nnFUE2oAnfaDD3UvPQqFFEHfnZCg7cpcYj39AzO5pN7UlZu89Xj/A4OuJSEs2m/JMSzK5GcrjB/DYkv4NnbWD7iw5Nrz9vPFWuY7syQXxXhX5aQvKM0CFcCoi5FvBeKnK0geUFIW8R8fnLj1ePQyig0CTBtWfg4Go9UoGwtC8QBt5C8WvOqFYeqlNstqwE0DyIFLq0XhbKA29q8bm3g7BkS/33FIC+I5DfW7SxRgxYBU35/vVjTm6rVdHtHjhBXFxE1BqW2kJbz+PIguaaBpMMLhKiRIdRXD3zK5OaqNjONu2WRH6G5aT4wrjDPkcceFHA3i1xrXSsGFtf1lqr1SJyNNu6aBr9JiwIL9wxcpPYc9raSf8rtFqGooit6AaHkSPNhkJSRDzstH2JSK252Wh003Z6ZehasuwWhAauxMlExqKbDk0uvPpyX1tw6TC6PHCf/+LL1wro/XcXmpAKJLf1pDIjtpPtSQ2WVxwVk0oLYK1M/P/70/M0nG89g9euxI6v3xKuUDnvqNyRvNK+9zzp8uAdaERoW+lewXkrvoX08KECN9zXmGLZpaXD7nmNM3wx8zLkHWiGJ/p/KS30JuaoNMLmVgsETSgVhQlOTfApzB5ntIrx1jcBs3QtAH44gwKOC/0WsT6JJvUfoAGmk4/gLBoRAN68YyMEAAAAASUVORK5CYII="
                    >
                      X
                    </option>
                  </select>
                  <div id="sm-icon-error" class="error"></div>
                </div>
                <div class="form-group w-100">
                  <label for="sm-0-link">Link to personal profile</label>
                  <input
                    type="text"
                    id="sm-0-link"
                    name="sm[0][link]"
                    placeholder="https://www.linkedin.com/company/xebia"
                  />
                  <div id="sm-link-error" class="error"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <button
              class="btn btn-md btn-dawn w-100 text-left font-semibold js-form-clone-btn"
              data-clone-target=".js-form-sm"
            >
              <img src="static/icon-btn-add.svg" alt="Icon add" />
              Add Social Media
            </button>
          </div>

          <div>
            <label for="cta-0-desc">
              Call to action
              <span>By default is generated this placeholder information</span>
            </label>
            <div class="js-form-cta" data-clone-count="0">
              <div class="form-wrapper flex flex-column mb-4">
                <div class="form-section">
                  <div class="form-group w-100">
                    <div class="relative flex items-center">
                      <input
                        type="text"
                        id="cta-0-desc"
                        class="js-input-maxlen"
                        name="cta[0][desc]"
                        maxlength="40"
                        placeholder="Read our latest insights"
                      />
                    </div>
                    <div id="cta-desc-error" class="error"></div>
                  </div>
                </div>
                <div class="form-section">
                  <div class="form-group select-icon-picker mb-0">
                    <select
                      class="js-choice"
                      id="cta-0-icon"
                      name="cta[0][icon]"
                    >
                      <option
                        data-custom-properties="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAATCAYAAACZZ43PAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEFSURBVHgBxVPbDYIwFL1tOgAbyAbqBDqC34REHMENcAOdQE14feIGbqBOICPwDQl4kGKMAVvkw5OQS+/j9L7KCHAcx8iybEE9UJZlGoZhzBBs5nl+gS6B0mCMGfi/ahCY8E0Egvc4H3zfX1uW5cIwCoJgpSKwbXteFMWeS6YT/QhOAyG6DFU5EMsWU4oSp0oC1HcQQpxb9KlWBlEUJRAJKdBJgC4vcNvkUy/nv1USSIxadIZWBp7nxRAxKTB4jP8nYFiY++tQP6Rnp5WB8IXfrmnilXO+ezN+DcZ45xAzbKT7JEDwEV0/kyaQtVkRkCzBpXrnj6SPMb5qyTZMMjoNYx+gB7cHtbptXtdqIQwAAAAASUVORK5CYII="
                        value="blog"
                      >
                        My articles in the blog
                      </option>
                      <option
                        data-custom-properties="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAATCAYAAACZZ43PAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAGISURBVHgBpVTLbcJAEN2195CjS3A62A4SV4C4IYQUUwGkgoQKgAqcSAg4hgogHbgDXIJz899546ydzco5WIw08q535s17M2vbTDPf910ppROGYcx6DOc4lnf6uaUHZFnmw1/YP5am6ZJi9HdcITtJkji2bS/qunarqnruA7Asa805j8qy3B6Px6gBIFp5np+R6LBhFsHHAskBKq4Oh8NmSPZ0Ot2AzdqiyqAesoEGOR8klwPpCiTqajwEQEl2hNqc2I+m5oCoYTk3cgJUXULul9pL+EgoOpfdbneh9WQycQlgv9+/6dlgGhRFcWq7P5vNHgE2aiRgv8KmARBC0BjP8HtD8xXuASRScRIxa6HRaxZ42SUYEujsbMRFrQRPl0DJkMANCTWxMiQEFrvR2jFu4aGi5ipJXg/9MVPjxrQkfNGOkb4BZiQEZjVqWleZc7oHcduDeU8P/kxB9cDTe4CiXQ+Gfkgti5h68Ir1E/xdA1vAV0Y8/Se27PfKNzlc0fPxeGDD7JNu6zcLQemKZat/GwAAAABJRU5ErkJggg=="
                        value="meeting"
                      >
                        Schedule a meeting
                      </option>
                      <option
                        data-custom-properties="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAATCAYAAACZZ43PAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAF1SURBVHgBrVTBbYNAEDwQfocOQgcmFUSpIPYXkEwqSKggcgXBFcADAU+oILiCpIOQDuwvSJCZ6BIhc9hC8kpo2buZZW92DyGuaZ7nrRzHKab2Xdd9J2a4pg+DrutMTdNuxBkjZhhrvu+bTdM8490H2ez7noBaReY+PTAHvFeLxSIwQH7B2qOu6wE8N8QlIwZJ3sg1ENwj2CVJUogZBq12cCuNwsiy6hl8VmHRG5J8gPuewSeHgpuGjMs0TWMxLtNn8izLCtUe3Eaf+gK6Y8FF+ErETk3hDAXRhrp227YbhDHPijiCVnu0rYjjuD6bAMQIzsTAlCg/RHs5G5yRV5n0bogfHQHALcUB8SPP8xrafPKde0j0dIofJeA8cC7wrP/OjmoeuMZk4pIG0pZ4blHyF9TmdNZI0KuAyi4AuweJxDXCLWIL/qjCGuyzvED/hr6HcOFgKT4lyot35BFKKoxSl2Ke8b8Q/F49/iQglD2Hjc5UELz6AYkLv0UBz55IAAAAAElFTkSuQmCC"
                        value="event"
                      >
                        Find me in the event
                      </option>
                      <option
                        data-custom-properties="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAATCAYAAACUef2IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIESURBVHgBtVS9UsJAED4CQ2t8AmMPTErL0NmJHTDMGEqr4BMgTyA8AXGGv47wBEJnZ2B4gFDaxYYBhh+/xbsYMYFYuDM3u7f37Xe7ez+M/ZPEgpy6riur1eoFpsKOi5NMJrOmaTqHC4kgNEh1qHGn07lkR6RYLPaXy2UOZj2QGIAmlCacsVhM3u12FjshwHxIklRFvOGLHbbb7bLIWIOjgWHTZLPZ6LBP8RLJ2Xa7HcTjcZPHqVCGlzEH2a1Wa8grUKByEYhlqIGIK5VKDBvt1yQOcKFkEYDyXPgu2GmRgXX8c8Q5HjF2GWNoYnW9Xtvon3KKFRg1kUjYvvkNhuMR8x7dCUCv13Oox2iJGkaKsjUoB1fN9RFrqODZI+Y9cguFQkWA6FDYkT5jndaGvo0MH9cX8d6QpDKyrIoseRUGC5cbkR0elIqN6hhZsRgXxmQycVKp1BLkzXQ6/Y67aGUymWv4zqfT6Sv72QYDZV8B84Aqc7D7cN93u92hwPy6rMhYh6rSRUfACPYTRhav0BbZ4WW+waQK6VxU6FvRglBiknw+rwD8SIF0FbEBHUyNHgRGBbbM/Y35fF63LMs95Dj6vGgD9FGjfrLvgzQxRiC0ggj/LPTh8D8lkkhRgfThQM2i4kNbwf/kqs8lHov30vAX14L+YpLA/5hksVjQ3fZnOAvChMknpEbxAnSaXUQAAAAASUVORK5CYII="
                        value="award"
                      >
                        Special / Award
                      </option>
                    </select>
                    <div id="cta-icon-error" class="error"></div>
                  </div>
                  <div class="form-group w-100 mb-0">
                    <div class="relative flex items-center">
                      <img
                        class="input-icon-img"
                        src="/static/icon-link.svg"
                        alt="Icon Watch"
                      />
                      <input
                        class="input-icon"
                        type="text"
                        id="cta-0-link"
                        name="cta[0][link]"
                        placeholder="https://www.xebia.com/news"
                      />
                    </div>
                    <div id="cta-link-error" class="error"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <button
              class="btn btn-md btn-dawn w-100 text-left font-semibold js-form-clone-btn"
              data-clone-target=".js-form-cta"
            >
              <img src="static/icon-btn-add.svg" alt="Icon add" />
              Add another Call to Action
            </button>
          </div>

          <div class="form-bottom">
            <a
              class="btn btn-outline btn-small"
              href="static/design.pdf"
              target="_blank"
            >
              <img src="/static/icon-watch.svg" alt="Icon Watch" />
              Design Guidelines
            </a>

            <input class="btn btn-primary" type="submit" value="Create" />
          </div>
        </form>
      </div>
      <div class="preview-container hidden">
        <h2 class="preview-header">Preview:</h2>
        <iframe
          class="preview-iframe"
          name="preview-iframe"
          src="/new/signature"
          height="100%"
          width="100%"
        ></iframe>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/choices.js@10.2.0/public/assets/scripts/choices.min.js"></script>
    <script>
      function validateForm() {
        let errors = document.getElementsByClassName('error');
        for (let i = 0; i < errors.length; i++) {
          errors[i].innerHTML = '';
        }
        let name = document.getElementById('full_name').value;
        if (name.trim() === '') {
          document.getElementById('full_name-error').innerHTML =
            'Please enter your name';
          return false;
        }
        let email = document.getElementById('email').value;
        if (!validateEmail(email)) {
          document.getElementById('email-error').innerHTML =
            'Please enter a valid email address';
          return false;
        }

        let job_role = document.getElementById('job_role').value;
        if (job_role.trim() === '') {
          document.getElementById('job_role-error').innerHTML =
            'Please enter your role';
          return false;
        }

        let phone = document.getElementById('phone').value;
        if (!validatePhoneNumber(phone)) {
          document.getElementById(
            'phone-error'
          ).innerHTML = `phone number (${phone} should start with a + followed by 10 to 15 digits without any other characters`;
          return false;
        }

        return true;
      }

      function prefillEmail(full_name) {
        let email = document.getElementById('email');
        if (email && full_name && !email.value) {
          let parts = full_name.split(/[ \t]+/);
          email.value =
            (parts.length > 1
              ? [parts[0], parts.slice(1).join('')].join('.')
              : parts[0]
            ).toLowerCase() + '@xebia.com';
        }
      }

      function validateEmail(email) {
        const re =
          /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(String(email).toLowerCase());
      }

      function validatePhoneNumber(phone) {
        const re = /^\+[0-9]{10,15}$/;
        return re.test(String(phone).toLowerCase());
      }

      function cloneFormGroup(cloneTarget) {
        let targetEl = document.querySelector(cloneTarget);

        if (!targetEl) return;

        let cloneEl = targetEl.initialNode.cloneNode(true);
        let cloneCount = parseInt(targetEl.dataset.cloneCount ?? 0) + 1;

        cloneEl.classList.remove(cloneTarget.replace(/^\./, ''));
        cloneEl.removeAttribute('data-clone-count');

        targetEl.dataset.cloneCount = cloneCount;
        cloneEl = prepareCloneFields(cloneCount, cloneEl);

        targetEl?.parentNode.appendChild(cloneEl);

        allMaxCharsCounterInit();
        allSelectInit();
      }

      function prepareCloneFields(number, wrapperNode) {
        wrapperNode.querySelectorAll('label')?.forEach((el) => {
          let forVal = el.getAttribute('for');
          el.setAttribute('for', forVal.replace(/-\d*-/, `-${number}-`));
        });

        wrapperNode.querySelectorAll('input')?.forEach((el) => {
          let nameVal = el.getAttribute('name');
          el.setAttribute('name', nameVal.replace(/\[\d*\]/, `[${number}]`));
          el.id = el.id.replace(/-\d*-/, `-${number}-`);
        });

        wrapperNode.querySelectorAll('select')?.forEach((el) => {
          let nameVal = el.getAttribute('name');
          el.setAttribute('name', nameVal.replace(/\[\d*\]/, `[${number}]`));
          el.id = el.id.replace(/-\d*-/, `-${number}-`);
        });

        return wrapperNode;
      }

      function allMaxCharsCounterInit() {
        document.querySelectorAll('.js-input-maxlen')?.forEach((el) => {
          let charsCounterClass = 'input-chars-counter';
          let charsCounterEl =
            el.parentElement.getElementsByClassName(charsCounterClass)[0];

          if (!charsCounterEl) {
            charsCounterEl = document.createElement('span');
            charsCounterEl.className = charsCounterClass;
            el.parentElement.insertBefore(charsCounterEl, el);
          }

          charsCounterEl.innerText = `${el.value.length}/${el.maxLength}`;

          el.addEventListener(
            'input',
            (e) =>
              (charsCounterEl.innerText = `${el.value.length}/${el.maxLength}`)
          );
        });
      }

      function selectInit(el) {
        el.originalInnerHTML = el.innerHTML;
        el.choices = new Choices(el, {
          searchEnabled: false,
          callbackOnCreateTemplates: function (template) {
            let classNames = this.config.classNames;
            let itemSelectText = this.config.itemSelectText;

            return {
              item: ({ classNames }, data) => {
                const { customProperties: iconData, label } = data;

                return template(`
                    <div class="${
                      data.highlighted
                        ? classNames.highlightedState
                        : classNames.itemSelectable
                    } ${
                  data.placeholder ? classNames.placeholder : ''
                }" data-item data-id="${data.id}" data-value="${data.value}" ${
                  data.active ? 'aria-selected="true"' : ''
                } ${data.disabled ? 'aria-disabled="true"' : ''}>
                  <img class="select-item-icon" src="${String(
                    iconData
                  )}" alt="Icon ${label}">
                    </div>
                  `);
              },
              choice: ({ classNames }, data) => {
                const { customProperties: iconData, label } = data;
                return template(`
                    <div
                      class="${classNames.item}"
                      data-select-text="${itemSelectText}"
                      data-choice
                      data-id="${data.id}"
                      data-value="${data.value}"
                      ${
                        data.disabled
                          ? 'data-choice-disabled aria-disabled="true"'
                          : 'data-choice-selectable'
                      }
                      id="${data.elementId}"
                    >
                      <img class="select-choice-icon" src="${String(
                        iconData
                      )}" alt="Icon ${label}">
                      ${String(data.label)}
                    </div>
                  `);
              },
            };
          },
        });
      }

      function allSelectInit() {
        let selectEls = document.querySelectorAll('.js-choice');
        selectEls.forEach((el) => {
          if (!el.choices) {
            selectInit(el);
          }
        });
      }

      function allCloneInit() {
        let formCloneBtn = document.querySelectorAll('.js-form-clone-btn');

        formCloneBtn?.forEach((el) => {
          let { cloneTarget } = el.dataset;
          let targetEl = document.querySelector(cloneTarget);
          if (!targetEl?.initalNode) {
            targetEl.initialNode = targetEl.cloneNode(true);
          }

          el.addEventListener('click', (e) => {
            e.preventDefault();
            cloneFormGroup(cloneTarget);
          });
        });
      }

      async function sendFormDataAsync(formEl) {
        let url = formEl.action;
        let formData = new FormData(formEl);

        return fetch(url, {
          method: 'POST',
          body: formData,
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
        });
      }

      function formInit() {
        let formEl = document.querySelector('.js-form');
        formEl?.addEventListener('submit', (e) => {
          e.preventDefault();

          let isValid = validateForm();
          if (isValid) {
            sendFormDataAsync(formEl)
              // .then((response) => response.json())
              .then((data) => {
                console.log(data);
              });
          }
        });
      }

      // TODO: temp solution
      function handleFormSubmit(e) {
        let previewContainer = document.querySelector('.preview-container');
        let previewIframe = previewContainer.querySelector('iframe');

        if (validateForm()) {
          previewContainer?.classList.remove('hidden');
          previewIframe.style.height =
            previewIframe.contentWindow.document.body.scrollHeight + 12 + 'px';
        } else {
          previewContainer?.classList.add('hidden');
        }
      }

      (() => {
        allCloneInit();
        allSelectInit();
        allMaxCharsCounterInit();
        // formInit();
      })();
    </script>
  </body>
</html>
